# üìö API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è GoodRobot

## üöÄ –û–±–∑–æ—Ä
API –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ GoodRobot –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç RESTful –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∞—Å—Ç–µ—Ä–∞–º–∏, –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏.

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç JWT —Ç–æ–∫–µ–Ω–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization: Bearer <token>`

```bash
# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
POST /token
Content-Type: application/x-www-form-urlencoded

username=admin&password=admin123&grant_type=password

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
GET /masters/1
Authorization: Bearer eyJhbGciOiJIUzI1NiIs...
```

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞–º–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
```http
GET /masters/api?skip=0&limit=10
Authorization: Bearer <token>
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `skip` (int): –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ–º—ã—Ö –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0)
- `limit` (int): –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10)
- `is_active` (bool, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `search` (str, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ username

**–û—Ç–≤–µ—Ç:**
```json
[
  {
    "id": 1,
    "username": "master1",
    "full_name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "telegram_id": 123456789,
    "is_active": true,
    "specialties": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"],
    "created_at": "2025-01-01T10:00:00"
  }
]
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–µ–π –º–∞—Å—Ç–µ—Ä–∞
```http
GET /masters/{master_id}
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "master": {
    "id": 1,
    "name": "–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤",
    "username": "master1",
    "email": "master1@example.com",
    "phone": "+7(999)123-45-67",
    "is_active": true,
    "categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"],
    "specialties": ["–≠–ª–µ–∫—Ç—Ä–∏–∫", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫"]
  },
  "all_categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞", "–ë—ã—Ç–æ–≤–∞—è —Ç–µ—Ö–Ω–∏–∫–∞", "–ö–ª–∏–Ω–∏–Ω–≥"],
  "all_specialties": ["–≠–ª–µ–∫—Ç—Ä–∏–∫", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫", "–ü–ª–æ—Ç–Ω–∏–∫", "–ú–∞–ª—è—Ä"],
  "master_stats": {
    "completed_orders": 15,
    "active_orders": 2
  }
}
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–∞—Å—Ç–µ—Ä–∞
```http
POST /api/masters/{master_id}/categories
Authorization: Bearer <token>
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"]
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ú–∏–Ω–∏–º—É–º 1 –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –º–∞–∫—Å–∏–º—É–º 10
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Å–ø–∏—Å–∫–∞
- –î—É–±–ª–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"],
  "master_id": 1,
  "updated_at": "2025-01-01T12:00:00"
}
```

### –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞/—Ä–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä–∞
```http
POST /api/masters/{master_id}/block
Authorization: Bearer <token>
```

```http
POST /api/masters/{master_id}/unblock
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–ú–∞—Å—Ç–µ—Ä –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω"
}
```

### –£–¥–∞–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞
```http
DELETE /api/masters/{master_id}
Authorization: Bearer <token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "message": "–ú–∞—Å—Ç–µ—Ä —É–¥–∞–ª–µ–Ω"
}
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –º–∞—Å—Ç–µ—Ä–æ–≤

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –º–∞—Å—Ç–µ—Ä–∞
```http
POST /api/masters/{master_id}/categories
Authorization: Bearer <token>
Content-Type: application/json
```

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞:**
```json
{
  "categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"]
}
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
- –ú–∏–Ω–∏–º—É–º 1 –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –º–∞–∫—Å–∏–º—É–º 10
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–∑ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ —Å–ø–∏—Å–∫–∞
- –î—É–±–ª–∏–∫–∞—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è
- –ü—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

**–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞—Å—Ç–µ—Ä–∞ –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ Redis –Ω–∞ 1 —á–∞—Å
- –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—ç—à –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- –û–±—â–∏–π –∫—ç—à –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è

**–û—Ç–≤–µ—Ç:**
```json
{
  "categories": ["–≠–ª–µ–∫—Ç—Ä–∏–∫–∞", "–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞"],
  "master_id": 1,
  "updated_at": "2025-01-01T12:00:00"
}
```

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –º–∞—Å—Ç–µ—Ä–æ–≤
- **–ö–ª—é—á:** `master:categories:{master_id}`
- **TTL:** 3600 —Å–µ–∫—É–Ω–¥ (1 —á–∞—Å)
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

#### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
- **–ö–ª—é—á:** `master:stats:{master_id}`
- **TTL:** 900 —Å–µ–∫—É–Ω–¥ (15 –º–∏–Ω—É—Ç)
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤

#### –û–±—â–∏–π –∫—ç—à –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
- **–ö–ª—é—á:** `masters:categories:all`
- **TTL:** 1800 —Å–µ–∫—É–Ω–¥ (30 –º–∏–Ω—É—Ç)
- **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è:** –ü—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π

### –õ–æ–≥–∏ API –∑–∞–ø—Ä–æ—Å–æ–≤
–í—Å–µ API –∑–∞–ø—Ä–æ—Å—ã –ª–æ–≥–∏—Ä—É—é—Ç—Å—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:
- `master_id`: ID –º–∞—Å—Ç–µ—Ä–∞
- `admin_username`: –ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- `user_agent`: User-Agent –∑–∞–ø—Ä–æ—Å–∞
- `timestamp`: –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
- `categories_count`: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (–¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```json
{
  "detail": [
    {
      "loc": ["body", "categories"],
      "msg": "–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏: –ù–µ–≤–µ—Ä–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è",
      "type": "value_error"
    }
  ]
}
```

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
```json
{
  "detail": "Not authenticated"
}
```

### –ù–µ –Ω–∞–π–¥–µ–Ω–æ
```json
{
  "detail": "–ú–∞—Å—Ç–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

### –°–µ—Ä–≤–µ—Ä–Ω–∞—è –æ—à–∏–±–∫–∞
```json
{
  "detail": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π"
}
```

## üõ†Ô∏è –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
python scripts/admin_management.py --list

# –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python scripts/admin_management.py create newadmin newpass123 --email admin@example.com

# –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è
python scripts/admin_management.py password admin newpassword123

# –í–∫–ª—é—á–µ–Ω–∏–µ/–≤—ã–∫–ª—é—á–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
python scripts/admin_management.py toggle admin

# –î–ª—è Docker –æ–∫—Ä—É–∂–µ–Ω–∏—è
python scripts/admin_management.py --docker --list
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
pytest

# –¢–µ—Å—Ç—ã API
pytest tests/test_api_categories_validation.py -v

# –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
pytest tests/test_schemas_validation.py -v

# –¢–µ—Å—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∞–º–∏
pytest tests/test_admin_management.py -v
```

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
```bash
pytest --cov=admin --cov-report=html
```

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
goodrobot/
‚îú‚îÄ‚îÄ admin/                 # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routers/      # API —Ä–æ—É—Ç–µ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schemas/      # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/    # Jinja2 —à–∞–±–ª–æ–Ω—ã
‚îÇ   ‚îî‚îÄ‚îÄ static/           # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îú‚îÄ‚îÄ app/                  # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ models/           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ bot/              # Telegram –±–æ—Ç
‚îÇ   ‚îî‚îÄ‚îÄ core/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ scripts/              # –°–∫—Ä–∏–ø—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
```

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
1. –û–±–Ω–æ–≤–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤ `app/models/category.py`
2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–π –≤ API

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞
–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.